/*
EDITABLE JQUERY PLUGIN
Licensing: Frank M. Taylor
https://github.com/paceaux/editable-jquery-plugin
*/
(function(e){e.fn.editable=function(t){function r(e,t){var n=document.createElement(e);if(t in n){return true}else{return false}}var n=e(this);var i={contenteditable:r("div","contenteditable"),scoped:r("style","scoped")},s=e.extend({trigger:"dblclick",stylable:false,recoverable:false,savable:false},t),o={init:function(){this.bindEvents();this.addIndexId();this.makeRecoverable();this.makeStylable()},removeEditable:function(t){if(e(t).is('[contenteditable="true"]')){e(t).removeAttr("contenteditable")}},makeEditable:function(t){if(e(t).is('[contenteditable="true"]')){e(t).removeAttr("contenteditable")}else{e(t).attr("contenteditable",true)}},addIndexId:function(){n.each(function(t){e(this).attr("id","ce-"+t)})},getChildEls:function(t){var n=[];e(t).children().each(function(t){var r=e(this).prop("tagName");if(t>0&&r!=="style"){n.push(r)}});return n},addChildElsToStyles:function(t){var n=o.getChildEls(e(t)),r=i.scoped===true?"":"#"+e(t).attr("id")+" ";e(t).find("style").append(r+"{} ");e.each(n,function(n,i){e(t).find("style").append(r+i+"{} ")})},makeStylable:function(){n.each(function(){if(s.stylable===true||e(this).attr("data-stylable")==="true"){e(this).find(".ce-styleBlock").remove();e(this).prepend('<style class="ce-styleBlock" scoped></style>');o.addChildElsToStyles(e(this))}})},makeRecoverable:function(){n.each(function(){if(s.recoverable===true||e(this).attr("data-recoverable")==="true"){var t=JSON.stringify(e(this).html());e(this).attr("data-original",t)}})},recoverContent:function(t){if(e(t).attr("data-original")){var n=JSON.parse(e(t).attr("data-original"));e(t).html(n)}},helpers:{keydown:function(t){var n=[];n[t.keyCode]=t.type==="keydown";if(n[27]){o.recoverContent(e(this))}}},bindEvents:function(){n.bind({mouseout:function(){setTimeout(function(){o.removeEditable(e(this))},500)},focusout:function(){setTimeout(function(){o.removeEditable(e(this))},500)}});if(s.trigger!=="dblclick"){n.on(s.trigger,function(){o.makeEditable(e(this));e(this).focus()})}else{n.bind({dblclick:function(){o.makeEditable(e(this));e(this).focus()}})}if(s.recoverable===true){n.bind({keydown:o.helpers.keydown})}else{n.each(function(){if(e(this).attr("data-original")||e(this).attr("data-recoverable")){e(this).bind({keydown:o.helpers.keydown})}})}}};o.init()}})(jQuery)